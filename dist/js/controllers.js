angular.module("registry.controllers",[]).controller("SessionController",["$scope","$rootScope","$location","API",function(o,e,t,r){o.logged=!1,r.getUser().success(function(t,r,n,i){e.logged=!0,e.user=t.username,o.logged=!0,o.user=t.username,o.photo=t._json.avatar_url}).error(function(e,t,r,n){o.err=!0}),o.signin=function(o){r.signin(o)},o.logout=function(){r.logout().success(function(o,e,t,r){window.location.href="/registry"}).error(function(e,t,r,n){o.err=!0})},o.getClass=function(o){return t.path().substr(0,o.length)==o?"selected":""}}]).controller("FavController",["$scope","$rootScope","API",function(o,e,t){o.favoriteList=[],e.logged&&(o.user=e.user,o.logged=e.logged,t.checkFav().success(function(e,t,r,n){o.favoriteList=e}).error(function(e,t,r,n){o.err=!0})),o.increment=function(o){e.logged&&(o.stars=o.stars+1)},o.toggleStatus=function(e){t.favFile(e._id).success(function(t,r,n,i){o.logged&&o.favoriteList.push(e._id)}).error(function(e,t,r,n){o.err=!0})},o.unToggleStatus=function(e){t.unFavFile(e._id).success(function(t,r,n,i){if(o.logged){var c=o.favoriteList.indexOf(e._id);o.favoriteList.splice(c,1)}}).error(function(e,t,r,n){o.err=!0})},o.isSelected=function(e){return o.favoriteList.indexOf(e._id)>-1}}]).controller("MainController",["$scope","$window","API",function(o,e,t){o.search=function(){""!==this.data.search&&(e.localStorage.search=this.data.search,window.location.href="/registry")},o.goTo=function(o){window.location.href="/registry"},o.signin=function(o){t.signin(o)}}]).controller("MyStackController",["$scope","API",function(o,e){o.logged=!0,e.getUserFiles().success(function(e,t,r,n){o.files=e,o.loaded=!0}).error(function(e,t,r,n){o.err=!0,o.loaded=!0}),o.deploy=function(o){window.location.href="/api/v1/deploy/"+o},o.showModal=!1,o.toggleModal=function(){o.showModal=!o.showModal},o.generateEmbed=function(e){o.embedScript='<script src="'+window.location.protocol+"//"+window.location.hostname+"/embed/file/"+e+'.js"></script>'},o.searchFile=function(){var t=this.data.search;e.searchFile(t).success(function(e,t,r,n){o.results=e}).error(function(e,t,r,n){o.err=!0})}}]).controller("FavoriteController",["$scope","$rootScope","API",function(o,e,t){e.logged&&(o.logged=e.logged),t.getUserFavorites().success(function(e,t,r,n){o.files=e,o.loaded=!0}).error(function(e,t,r,n){o.err=!0,o.loaded=!0}),o.deploy=function(o){window.location.href="/api/v1/deploy/"+o},o.showModal=!1,o.toggleModal=function(){o.showModal=!o.showModal},o.generateEmbed=function(e){o.embedScript='<script src="'+window.location.protocol+"//"+window.location.hostname+"/embed/file/"+e+'.js"></script>'},o.removeRow=function(e){for(var t=-1,r=0;r<o.files.length;r++)if(o.files[r]._id===e._id){t=r;break}-1===t&&alert("Oops something went wrong"),o.files.splice(t,1)},o.searchFile=function(){var e=this.data.search;t.searchFile(e).success(function(e,t,r,n){o.results=e}).error(function(e,t,r,n){o.err=!0})}}]).controller("RegistryController",["$scope","$rootScope","$window","API","Loader",function(o,e,t,r,n){o.files=new n,e.logged===!0?(r.checkFav().success(function(e,t,r,n){o.favoriteList=e,o.loaded=!0}).error(function(e,t,r,n){o.err=!0}),o.logged=!0):o.loaded=!0,o.showModal=!1,o.toggleModal=function(){o.copyText={status:"notClicked"},o.showModal=!o.showModal},o.generateEmbed=function(e){o.embedScript='<script src="'+window.location.protocol+"//"+window.location.hostname+"/embed/file/"+e+'.js"></script>'},o.deploy=function(o){window.location.href="/api/v1/deploy/"+o},o.searchFile=function(){var e=this.data.search;r.searchFile(e).success(function(e,t,r,n){o.results=e}).error(function(e,t,r,n){o.err=!0})},o.checkSearch=function(){void 0!==t.localStorage.search&&(o.data={search:t.localStorage.search},r.searchFile(t.localStorage.search).success(function(e,t,r,n){o.results=e}).error(function(e,t,r,n){o.err=!0}),t.localStorage.clear())}}]).controller("RegistryDetailsController",["$scope","$rootScope","$window","$routeParams","API",function(o,e,t,r,n){n.getFileWithId(r.registryId).success(function(e,t,r,i){o.data=e,n.getYAMLFile(e._id,e.projectName,e.path).success(function(e,t,r,n){o.composeFile=e,o.loaded=!0}).error(function(e,t,r,n){o.composeFile="Unable to fetch tutum.yml from Github repository. Please select a repository that contains a tutum.yml or a docker-compose.yml file",o.loaded=!0})}).error(function(o,e,t,r){window.location.href="/404"}),e.logged&&(o.user=e.user,o.logged=e.logged),o.showModal=!1,o.toggleModal=function(){o.showModal=!o.showModal},o.generateEmbed=function(e){o.embedScript='<script src="'+window.location.protocol+"//"+window.location.hostname+"/embed/file/"+e+'.js"></script>'},o.deploy=function(o){window.location.href="/api/v1/deploy/"+o},o.toggleStatus=function(e){o.favoriteList.push(e._id),n.favFile(e._id).success(function(o,e,t,r){}).error(function(e,t,r,n){o.err=!0})},o.isSelected=function(e){return o.favoriteList.indexOf(e._id)>-1},o.deleteStackfile=function(e){n.deleteStackfile(e).success(function(o,e,r,n){t.location.href="/registry"}).error(function(e,t,r,n){o.err=!0})}}]).controller("CreateController",["$scope","$rootScope","$window","API",function(o,e,t,r){e.logged&&(o.user=e.user,o.logged=e.logged),o.getOrgs=function(){var e=[];o.stackfile="Window will automatically refresh after filling form.",r.getUserOrgs().success(function(t,r,n,i){angular.forEach(t,function(o,t){e.push(o.login)}),e.push(o.user),o.orgs=e}).error(function(e,t,r,n){o.err=!0})},o.getRepos=function(){var e=[];o.data.path="/",o.stackfile="Window will automatically refresh after filling form.",r.getUserRepos(o.data.orgname).success(function(t,r,n,i){o.repos=[],angular.forEach(t,function(o,t){e.push(o.name)}),o.repos=e}).error(function(e,t,r,n){o.err=!0})},o.getBranches=function(){var e=[];o.data.path="/",o.stackfile="Window will automatically refresh after filling form.",null!==o.data.reponame&&(o.branches=[],r.getRepoBranches(o.data.orgname,o.data.reponame).success(function(t,r,n,i){angular.forEach(t,function(o,t){e.push(o)}),o.branches=e}).error(function(e,t,r,n){o.err=!0}))},o.locked=!1,o.getComposeFile=function(e,t,n,i){o.stackfile="",r.getUserReposInfo(e,t,n,i).success(function(e,t,r,n){"File not found"===e?(o.stackfile="Unable to fetch tutum.yml from Github repository. Please select a repository that contains a tutum.yml or a docker-compose.yml file",o.locked=!0):(o.locked=!1,o.stackfile=e)}).error(function(e,t,r,n){o.err=!0})},o.createNew=function(){var e=this.data.title,n=jsyaml.load(o.stackfile),i=this.data.branch,c=this.data.path,s=this.data.reponame,a=this.data.orgname,l=this.data.description,u={title:e.replace(/[^a-zA-Z0-9]/g," "),stackfile:n,branch:i,path:c,name:s,orgname:a,description:l};r.saveFile(u).success(function(o,e,r,n){t.location.href="/registry"}).error(function(o,e,t,r){window.location.href="/404"})}}]);